buildscript {
    repositories {
        jcenter()
        mavenCentral()
        maven { url 'https://maven.fabric.io/public' }
        maven { url "https://jitpack.io" }
        google()
    }

    dependencies {
        // These docs use an open ended version so that our plugin
        // can be updated quickly in response to Android tooling updates

        // We recommend changing it to the latest version from our changelog:
        // https://docs.fabric.io/android/changelog.html#fabric-gradle-plugin
        classpath 'io.fabric.tools:gradle:1.25.3'
        //noinspection GradleDependency
        classpath 'com.jakewharton:butterknife-gradle-plugin:8.4.0'
    }
}

apply plugin: 'com.google.gms.google-services'
apply plugin: 'com.android.application'
apply plugin: 'io.fabric'

repositories {
    jcenter()
    mavenCentral()
    maven { url 'https://maven.fabric.io/public' }
    maven { url "https://artifactory.9elements.com/artifactory/imgly" }
    google()
}

def useReact = System.getenv("USE_REACT") ?: 'false'

apply plugin: 'com.jakewharton.butterknife'

// Configures the bundleJS commands for React-Native
project.ext.react = [
        nodeExecutableAndArgs : ["/usr/local/bin/node"],

        // whether to bundle JS and assets in debug mode
        bundleInDebug: true,
        // whether to bundle JS and assets in release mode
        bundleInRelease: true,

        // the root of your RN project, i.e. where "package.json" lives
        root: "../../"
]

apply from: "../../node_modules/react-native/react.gradle"

android {
    compileSdkVersion 26
    buildToolsVersion '27.0.3'

    println "$projectDir/autosignature.properties"

    if (file("$projectDir/autosignature.properties").exists()) {
        println "auto signature is configured"

        def signaturesFile = file("$projectDir/autosignature.properties")
        def props = new Properties()
        props.load(new FileInputStream(signaturesFile))

        signingConfigs {
            developmentCfg {
                keyAlias props['development.keystore.keyAlias']
                keyPassword props['development.keystore.keyPassword']
                storeFile file("$projectDir/keystore/" + props['development.keystore'])
                storePassword props['development.store.password']
            }
            stagingCfg {
                keyAlias props['staging.keystore.keyAlias']
                keyPassword props['staging.keystore.keyPassword']
                storeFile file("$projectDir/keystore/" + props['staging.keystore'])
                storePassword props['staging.store.password']
            }
            productionCfg {
                keyAlias props['production.keystore.keyAlias']
                keyPassword props['production.keystore.keyPassword']
                storeFile file("$projectDir/keystore/" + props['production.keystore'])
                storePassword props['production.store.password']
            }
        }

        buildTypes {
            debug {
                debuggable true
                minifyEnabled false
                buildConfigField "boolean", "IS_DEBUG", "true"
                proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
                signingConfig signingConfigs.developmentCfg
            }

            staging {
                debuggable false
                minifyEnabled false
                buildConfigField "boolean", "IS_DEBUG", "true"
                proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
                signingConfig signingConfigs.stagingCfg


            }
            release {
                debuggable false
                minifyEnabled false
                buildConfigField "boolean", "IS_DEBUG", "false"
                proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
                signingConfig signingConfigs.productionCfg
            }
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    defaultConfig {
        applicationId "com.behuman"
        minSdkVersion 21
        versionCode 370
        versionName "1.1"
        multiDexEnabled true
        // render script for photo editor sdk
        renderscriptTargetApi 24
        renderscriptSupportModeEnabled true

        ndk {
            abiFilters "armeabi-v7a", "x86"
        }
    }

    dexOptions {
        javaMaxHeapSize "8g"
    }

    dataBinding {
        enabled = true
    }

    lintOptions {
        checkReleaseBuilds false
        abortOnError false
    }

    flavorDimensions "main"

    productFlavors {
        dev {
            dimension "main"
            applicationId "com.behuman.dev"
            versionCode 1
            versionName "Dev 1.0"

            resValue "string", "app_name", "beHuman Development"
            resValue "string", "facebookId", "359342084433275"
            resValue "string", "facebookContentProvider", "com.facebook.app.FacebookContentProvider359342084433275"
            resValue "string", "serviceBaseUrl", "http://behuman-stage-api-249526446.us-east-1.elb.amazonaws.com"
            resValue "string", "serviceVersion", "V2"
            resValue "string", "apiToken", "nt7AwF6YVzwQqsDB"
            resValue "string", "aesCbcKey", "05BD695D3614599398E0045D493EEF2C"
            resValue "string", "aesCbcIv", "8D0E3D356C5FFC98"
            resValue "string", "termsUrl", "http://www.behuman.com/behuman-terms.html"
            resValue "string", "googleApiKey", "AIzaSyD76UwswbNViTZY88vGOInu-sK-hub4TNQ"
            // intentions tags ids
            resValue "string", "gratitude", "1"
            resValue "string", "family", "3"
            resValue "string", "giving", "4"
            resValue "string", "education", "5"
            resValue "string", "youth", "6"
            resValue "string", "health", "7"
            resValue "string", "community", "8"
            resValue "string", "poverty", "9"
            resValue "string", "respect", "17"
            resValue "string", "animal_rescue", "11"
            resValue "string", "wildlife", "14"
            resValue "string", "peace", "18"
            resValue "string", "environmental", "15"
            resValue "string", "love", "2"
            resValue "string", "water", "13"
            resValue "string", "humility", "22"
            resValue "string", "volunteer", "24"
            resValue "string", "leadership", "23"
            resValue "string", "food", "20"
            resValue "string", "equality", "21"
            // intentions tags names
            resValue "string", "_1", "Gratitude"
            resValue "string", "_3", "Family"
            resValue "string", "_4", "Giving"
            resValue "string", "_5", "Education"
            resValue "string", "_6", "Youth"
            resValue "string", "_7", "Health"
            resValue "string", "_8", "Community"
            resValue "string", "_9", "Poverty"
            resValue "string", "_17", "Respect"
            resValue "string", "_19", "Animal Rescue"
            resValue "string", "_11", "Animal Rescue"
            resValue "string", "_14", "Wildlife"
            resValue "string", "_18", "Peace"
            resValue "string", "_15", "Environmental"
            resValue "string", "_2", "Love"
            resValue "string", "_13", "Water"


            buildConfigField 'String', 'REMOTE_HOST', '"http://behuman-stage-api-249526446.us-east-1.elb.amazonaws.com/"'
            buildConfigField 'String', 'MS_APPCENTER_ID', '"84030b0c-4d9b-4722-ad76-f0b3d632cc5b"'
            buildConfigField "String", "AMPLITUDE_ID", '"8aa8936dda59b1ad6ed91cd5686af11b"'
            buildConfigField 'boolean', 'DEV', 'true'
            buildConfigField 'boolean', 'USE_REACT', useReact
        }
        prod {
            dimension "main"
            applicationId "com.behuman.inc"
            versionCode 370
            versionName "1.1"

            resValue "string", "app_name", "beHuman"
            resValue "string", "facebookId", "359342084433275"
            resValue "string", "facebookContentProvider", "com.facebook.app.FacebookContentProvider359342084433275"
            resValue "string", "serviceBaseUrl", "http://api.behuman.com"
            resValue "string", "serviceVersion", "V2"
            resValue "string", "apiToken", "nt7AwF6YVzwQqsDB"
            resValue "string", "aesCbcKey", "05BD695D3614599398E0045D493EEF2C"
            resValue "string", "aesCbcIv", "8D0E3D356C5FFC98"
            resValue "string", "termsUrl", "http://www.behuman.com/behuman-terms.html"
            resValue "string", "googleApiKey", "AIzaSyD76UwswbNViTZY88vGOInu-sK-hub4TNQ"
            // intentions tags ids
            resValue "string", "gratitude", "1"
            resValue "string", "family", "3"
            resValue "string", "giving", "4"
            resValue "string", "education", "5"
            resValue "string", "youth", "6"
            resValue "string", "health", "7"
            resValue "string", "community", "8"
            resValue "string", "poverty", "9"
            resValue "string", "respect", "17"
            resValue "string", "animal_rescue", "11"
            resValue "string", "wildlife", "14"
            resValue "string", "peace", "18"
            resValue "string", "environmental", "15"
            resValue "string", "love", "2"
            resValue "string", "water", "13"
            resValue "string", "humility", "22"
            resValue "string", "volunteer", "24"
            resValue "string", "leadership", "23"
            resValue "string", "food", "20"
            resValue "string", "equality", "21"
            // intentions tags names
            resValue "string", "_1", "Gratitude"
            resValue "string", "_3", "Family"
            resValue "string", "_4", "Giving"
            resValue "string", "_5", "Education"
            resValue "string", "_6", "Youth"
            resValue "string", "_7", "Health"
            resValue "string", "_8", "Community"
            resValue "string", "_9", "Poverty"
            resValue "string", "_17", "Respect"
            resValue "string", "_11", "Animal Rescue"
            resValue "string", "_14", "Wildlife"
            resValue "string", "_18", "Peace"
            resValue "string", "_15", "Environmental"
            resValue "string", "_2", "Love"
            resValue "string", "_13", "Water"

            buildConfigField 'String', 'REMOTE_HOST', '"http://api.behuman.com/"'
            buildConfigField 'String', 'MS_APPCENTER_ID', '"84030b0c-4d9b-4722-ad76-f0b3d632cc5b"'
            buildConfigField "String", "AMPLITUDE_ID", '"164afcb3f9209ed08e7c63f443150ddd"'
            buildConfigField 'boolean', 'DEV', 'false'
            buildConfigField 'boolean', 'USE_REACT', 'false'
        }
    }

    android.applicationVariants.all { variant ->
        variant.outputs.all {
            outputFileName = "behuman-android-${variant.name}-${variant.versionName}.apk"
        }
    }

    packagingOptions {
        exclude 'META-INF/rxjava.properties'
    }
}

ext {
    playServicesVersion = '15.0.0'
    androidSupportVersion = '26.1.0'
    androidDataBindingVersion = '1.3.3'
    appCenterSdkVersion = '1.4.0'
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])

    implementation project(':react-native-linear-gradient')

    // Google
    implementation "com.google.android.gms:play-services-location:$playServicesVersion"
    implementation "com.google.android.gms:play-services-places:$playServicesVersion"
    implementation "com.google.firebase:firebase-core:$playServicesVersion"
    implementation "com.google.firebase:firebase-messaging:$playServicesVersion"
    implementation 'com.github.google:cameraview:3eaeac09a7'
    implementation 'com.google.android:flexbox:0.3.1'
    implementation 'com.github.davidmigloz:youtube-android-player-api-gradle:1.2.2'

    // Android SDK
    implementation 'com.android.support:multidex:1.0.3'
    implementation "com.android.support.constraint:constraint-layout:1.1.0"
    implementation "com.android.support:appcompat-v7:$androidSupportVersion"
    implementation "com.android.support:animated-vector-drawable:$androidSupportVersion"
    implementation "com.android.support:customtabs:$androidSupportVersion"
    implementation "com.android.support:exifinterface:$androidSupportVersion"
    implementation "com.android.support:design:$androidSupportVersion"
    implementation "com.android.support:cardview-v7:$androidSupportVersion"
    implementation "com.android.support:percent:$androidSupportVersion"
    implementation "com.android.support:palette-v7:$androidSupportVersion"
    implementation "com.android.databinding:library:$androidDataBindingVersion"
    implementation "com.android.databinding:adapters:$androidDataBindingVersion"

    // Amplitude
    implementation 'com.amplitude:android-sdk:2.14.1'

    // View Binding
    implementation 'com.jakewharton:butterknife:8.8.1'
    annotationProcessor 'com.jakewharton:butterknife-compiler:8.8.1'

    //Networking
    implementation group: 'com.squareup.okhttp3', name: 'okhttp', version: '3.10.0'
    implementation group: 'com.squareup.okhttp3', name: 'logging-interceptor', version: '3.6.0'
    implementation group: 'com.squareup.retrofit2', name: 'retrofit', version: '2.3.0'
    implementation group: 'com.squareup.retrofit2', name: 'adapter-rxjava', version: '2.1.0'
    implementation group: 'com.squareup.retrofit2', name: 'converter-gson', version: '2.3.0'

    //RxJava
    implementation group: 'io.reactivex', name: 'rxjava', version: '1.2.2'
    implementation group: 'io.reactivex', name: 'rxandroid', version: '1.2.1'
    implementation group: 'com.jakewharton.rxbinding', name: 'rxbinding', version: '0.4.0'

    // Apache
    implementation 'org.apache.commons:commons-collections4:4.0'
    implementation 'org.apache.commons:commons-lang3:3.5'
    implementation 'commons-io:commons-io:2.4'

    // Utils
    implementation 'com.google.code.gson:gson:2.8.2'
    implementation 'joda-time:joda-time:2.9.9'

    //Fonts
    implementation group: 'uk.co.chrisjenx', name: 'calligraphy', version: '2.3.0'

    //Image handling
    implementation 'ly.img.android:photo-editor-sdk:5.0.20'
    implementation "com.davemorrissey.labs:subsampling-scale-image-view:3.7.0"
    implementation "com.github.bumptech.glide:glide:3.8.0"
    implementation "com.github.bumptech.glide:okhttp-integration:1.5.0"
    implementation 'com.squareup.picasso:picasso:2.5.2'
    implementation 'com.fivehundredpx:blurringview:1.0.0'
    implementation 'jp.wasabeef:blurry:2.1.1'
    implementation 'com.wonderkiln:blurkit:1.0.0'

    //Social Media
    implementation group: 'com.facebook.android', name: 'facebook-android-sdk', version: '4.27.0'

    // UI
    implementation 'me.relex:circleindicator:1.2.2@aar'
    implementation 'de.hdodenhof:circleimageview:2.2.0'
    implementation 'com.github.pwittchen:infinitescroll:0.0.1'
    implementation 'org.zakariya.stickyheaders:stickyheaders:0.7.6'
    implementation 'com.airbnb.android:lottie:2.2.5'
    implementation 'com.appolica:flubber:1.0.1'

    // Logging
    implementation 'com.jakewharton.timber:timber:4.5.1'
    implementation('com.crashlytics.sdk.android:crashlytics:2.8.0@aar') {
        transitive = true
    }

    //BarCode Generation
    implementation 'com.journeyapps:zxing-android-embedded:3.0.2@aar'
    implementation 'com.google.zxing:core:3.3.0'

    // color picker
    implementation 'com.github.skydoves:colorpickerview:1.0.8'

    implementation "com.davemorrissey.labs:subsampling-scale-image-view:3.7.0"
    implementation "com.github.bumptech.glide:glide:3.8.0"
    implementation "com.github.bumptech.glide:okhttp-integration:1.5.0"
    // grouped recycler view
    implementation 'org.zakariya.stickyheaders:stickyheaders:0.7.6'
    implementation 'com.github.ybq:Android-SpinKit:1.1.0'
    // Photo View and Cropper
    implementation 'com.github.chrisbanes:PhotoView:2.1.3'
    implementation 'com.flying.xiaopo:sticker:1.6.0'

    // React
    implementation 'com.facebook.react:react-native:+' // From node_modules.

    // mentions
    implementation 'com.github.percolate:mentions:0.1.1'

    // Microsoft App Center
    implementation "com.microsoft.appcenter:appcenter-analytics:${appCenterSdkVersion}"
    implementation "com.microsoft.appcenter:appcenter-crashes:${appCenterSdkVersion}"
}
